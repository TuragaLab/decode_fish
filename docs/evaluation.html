---

title: Performance evaluation


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/10_evaluation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_evaluation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="matching" class="doc_header"><code>matching</code><a href="https://github.com/TuragaLab/decode_fish/tree/master/decode_fish/funcs/evaluation.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>matching</code>(<strong><code>target_df</code></strong>, <strong><code>pred_df</code></strong>, <strong><code>tolerance</code></strong>=<em><code>500</code></em>, <strong><code>print_res</code></strong>=<em><code>True</code></em>, <strong><code>eff_const</code></strong>=<em><code>0.5</code></em>)</p>
</blockquote>

<pre><code>Matches localizations to ground truth positions and provides assessment metrics used in the SMLM2016 challenge.
(see http://bigwww.epfl.ch/smlm/challenge2016/index.html?p=methods#6)
When using default parameters exactly reproduces the procedure used for the challenge (i.e. produces same numbers as the localization tool).

Parameters
----------
test_csv: str or list
    Ground truth positions with columns: 'localization', 'frame', 'x', 'y', 'z'
    Either list or str with locations of csv file.
pred_inp: list
    List of localizations
size_xy: list of floats
    Size of processed recording in nano meters
tolerance: float
    Localizations are matched when they are within a circle of the given radius.
tolerance_ax: float
    Localizations are matched when they are closer than this value in z direction. Should be ininity for 2D recordings. 500nm is used for 3D recordings in the challenge.
border: float
    Localizations that are close to the edge of the recording are excluded because they often suffer from artifacts.
print_res: bool
    If true prints a list of assessment metrics.
min_int: bool
    If true only uses the brightest 75% of ground truth locations.
    This is the setting used in the leaderboard of the challenge. However this implementation does not exactly match the method used in the localization tool.

Returns
-------
perf_dict, matches: dict, list
    Dictionary of perfomance metrics.
    List of all matches localizations for further evaluation in format: 'localization', 'frame', 'x_true', 'y_true', 'z_true', 'x_pred', 'y_pred', 'z_pred', 'int_true', 'x_sig', 'y_sig', 'z_sig'</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">img</span><span class="p">,</span> <span class="n">gt_df</span><span class="p">,</span> <span class="n">fq_nog_df</span><span class="p">,</span> <span class="n">fq_gmm_df</span> <span class="o">=</span> <span class="n">load_sim_fish</span><span class="p">(</span><span class="n">simfish_dir</span><span class="o">+</span><span class="s1">&#39;sim_1/&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;cell3D&#39;</span><span class="p">,</span> <span class="s1">&#39;strong&#39;</span><span class="p">)</span>
<span class="n">model_out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;../data/model_output.pt&#39;</span><span class="p">)</span>
<span class="n">model_preds</span> <span class="o">=</span> <span class="n">model_output_to_df</span><span class="p">(</span><span class="n">model_out</span><span class="p">,</span> <span class="n">px_size</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/groups/turaga/home/speisera/share_TUM/FishSIM/sim_1//mRNAlevel_200/cell3D/strong/w1_HelaKyoto_Gapdh_2597_p01_cy3__Cell_CP_14__cell3D__1.tif
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">model_preds</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">shift_df</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">50.</span><span class="p">,</span><span class="o">-</span><span class="mf">50.</span><span class="p">,</span><span class="mf">7350.</span><span class="p">])</span>
<span class="n">perf_df</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">matching</span><span class="p">(</span><span class="n">gt_df</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Recall: 0.975
Precision: 1.000
Jaccard: 97.458
RMSE_vol: 43.615
Eff_3d: 78.045
FN: 6.0 FP: 0.0
Shift: -5.88,-18.35,8.44
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">fq_gmm_df</span>
<span class="n">perf_df</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">matching</span><span class="p">(</span><span class="n">gt_df</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Recall: 0.958
Precision: 0.974
Jaccard: 93.388
RMSE_vol: 116.393
Eff_3d: 41.429
FN: 10.0 FP: 6.0
Shift: -32.13,-32.89,-98.43
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>nbdev_build_lib
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_models.ipynb.
Converted 01_psf.ipynb.
Converted 02_microscope.ipynb.
Converted 03_noise.ipynb.
Converted 04_pointsource.ipynb.
Converted 05_gmm_loss.ipynb.
Converted 06_plotting.ipynb.
Converted 07_file_io.ipynb.
Converted 08_dataset.ipynb.
Converted 09_output_trafo.ipynb.
Converted 10_evaluation.ipynb.
Converted 11_emitter_io.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

